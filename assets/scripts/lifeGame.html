<!DOCTYPE html>
<html>
<head>
<title>
Game Of Life
</title>

</head>

<body style="background-color:#000000;">
<!--
<h1 style="color:white;">lifeGame</h1>-->

<h1 style="color:white; text-align: center;">Juego de la Vida</h1>
</br>
<button type="button" onclick="window.history.back();">Vovler al Menu</button>
</br>
<canvas id="Mundo" width="700" height="700"
style="background-color:black; border:1px solid; border-color:white; text-align: center;">
</canvas>
</br>
<button onclick="iniciar()">Limpiar</button>
<button onclick="nextTurn()">Paso</button>
<button onclick="active()">Comenzar/Detener</button>
<button onclick="printNivel()">Guardar posición</button>
<button onclick="setNivel()">Ultimo Guardado</button>

<script>


var size = 70;
var actual = [];
var proximo = [];
var go = false;

function toggleJugadores(){
	jugadores = (jugadores+1)%3;
	iniciar();
}

function active(){
	go = !go;
	drawloop();
}

function drawloop(){
	if(go){
		nextTurn();
		setTimeout(drawloop, 100);
	}
}

iniciar();

function iniciar(){
	size = 70; //todavía falta ver cómo alterar eso.
	go = false;
	llenarCeros();
	paint();
}


var mundillo = document.getElementById("Mundo");
mundillo.addEventListener("click", set);


function llenarCeros(){
	actual = [];
	var i = 0;
	while(i < size){
		var ceros = [];
		var j = 0;
		while(j < size){
			ceros.push(0);
			j++;
		}
		actual.push(ceros);
		i++;
	}

	proximo = [];
	var h = 0;
	while(h < size){
		var ceross = [];
		var o = 0;
		while(o < size){
			ceross.push(0);
			o++;
		}
		proximo.push(ceross);
		h++;
	}
}

function vecinos(i, j){
	var acum = 0;
	if(i > 0){
		acum += actual[i-1][j];
	}
	if(i < size-1){
		acum += actual[i+1][j];
	}
	if(j > 0){
		acum += actual[i][j-1];
	}
	if(j < size-1){
		acum += actual[i][j+1];
	}
	if(i>0 && j>0){
		acum += actual[i-1][j-1];
	}
	if(i>0 && j<(size-1)){
		acum += actual[i-1][j+1];
	}
	if(i<(size-1) && j>0){
		acum += actual[i+1][j-1];
	}
	if(i<(size-1) && j<(size-1)){
		acum += actual[i+1][j+1];
	}
	return acum;
}



function paint(){
	var canvas = document.getElementById("Mundo");
	var ctx = canvas.getContext("2d");
	ctx.fillStyle = "black";
	ctx.fillRect(0, 0, 1000, 1000);
	var i = 0;
	while(i < size){
		var j = 0;
		while(j < size){
			if(actual[i][j] == 1){
				ctx.fillStyle = "#FFFFFF";
			} else {
				ctx.fillStyle = "#000000";
			}
			ctx.fillRect(i*10 + 1, j*10 + 1, 8, 8);
		j++;
		}
	i++;
	}
}


function nextTurn(){
	var i = 0;
	while(i < size){
		var j = 0;
		while(j < size){
			//document.getElementById("debugger2").innerHTML += (((actual[i][j] == 1 && vecinos(i, j) == 2 )|| vecinos(i, j) == 3) ? "true" : "false" );
			if((actual[i][j] == 1 && vecinos(i, j) == 2) || vecinos(i, j) == 3){
				proximo[i][j] = 1;
			} else {
				proximo[i][j] = 0;
			}
		j++;
		}
	i++;
	}
	copiar();
	paint();

}

function copiar(){
	var i = 0;
	while(i < size){
		var j = 0;
		while(j < size){
			var o = proximo[i][j];
			actual[i][j] = o;
		j++;
		}
	i++;
	}
}

function set(event){
	var i = event.offsetX;
	var j = event.offsetY;

	i = Math.floor(i/10);
	j = Math.floor(j/10);


	if(actual[i][j] == 1){
		actual[i][j] = 0;
	} else {
		actual[i][j] = 1;
	}
	paint();
}

function printNivel(){
	nivel = [];
	var i = 0;
	while(i < size){
		var j = 0;
		while(j < size){
			if(actual[i][j] != 0){
				nivel.push(i);
				nivel.push(j);
			}
			j++;
		}
		i++;
	}
}

var nivel = [];

function setNivel(){ // usa variable global nivel.
	iniciar();
	var i = 0;
	while(i < nivel.length){
		actual[nivel[i]][nivel[i+1]] = 1;
		i = i+2;
	}
	paint();
}

var rPentomino = [ 31, 32, 32, 31, 32, 32, 32, 33, 33, 31 ];
var blinker = [ 33, 34, 34, 34, 35, 34 ];

function defLevel(lvl){
	iniciar();
	var i = 0;
	while (i < lvl.length){
		actual[lvl[i]][lvl[i+1]] = 1;
		i = i+2;
	}
	paint();
}


</script>

</br>

<p id="nivel" style="color:white"></p>

<p style="color:white">
	Un ejemplo de methuselah es el <a href="javascript:;" onclick="defLevel(rPentomino)">R-Pentomino</a>. Un ejemplo de oscilador es un <a href="javascript:;" onclick="defLevel(blinker)">"blinker"</a>, o lo que diríamos en español un pestañeante.
</p>

</body>
</html>
